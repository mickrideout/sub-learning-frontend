{% extends "base.html" %}

{% block title %}Learning Interface - Sub Learning{% endblock %}

{% block content %}
<div class="learning-container">
    <!-- Header Controls -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2>Learning Interface</h2>
                <div class="controls-group">
                    <!-- Font Size Controls -->
                    <div class="btn-group me-3" role="group" aria-label="Font size controls">
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="font-small">
                            <i class="fas fa-font" style="font-size: 0.8em;"></i> S
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="font-medium">
                            <i class="fas fa-font"></i> M
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm active" id="font-large">
                            <i class="fas fa-font" style="font-size: 1.2em;"></i> L
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="font-xlarge">
                            <i class="fas fa-font" style="font-size: 1.4em;"></i> XL
                        </button>
                    </div>
                    
                    <!-- Column Width Controls -->
                    <div class="btn-group me-3" role="group" aria-label="Column width controls">
                        <button type="button" class="btn btn-outline-primary btn-sm" id="width-equal">
                            <i class="fas fa-columns"></i> Equal
                        </button>
                        <button type="button" class="btn btn-outline-primary btn-sm" id="width-left">
                            <i class="fas fa-arrow-left"></i> Left
                        </button>
                        <button type="button" class="btn btn-outline-primary btn-sm" id="width-right">
                            <i class="fas fa-arrow-right"></i> Right
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Indicator -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: 0%" 
                     aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="progress-bar">
                    <span id="progress-text">0 / 0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Controls -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="d-flex justify-content-center">
                <div class="btn-group" role="group" aria-label="Navigation controls">
                    <button type="button" class="btn btn-primary" id="btn-prev" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <button type="button" class="btn btn-primary" id="btn-next" disabled>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Split-screen Subtitle Display -->
    <div class="row">
        <div class="col-12">
            <div class="dual-subtitle-container">
                <div class="row" id="subtitle-row">
                    <div class="col-md-6" id="source-column">
                        <div class="subtitle-panel">
                            <h5 class="panel-title" id="source-lang-title">Source Language</h5>
                            <div class="subtitle-content" id="source-content">
                                <div class="subtitle-line-placeholder">
                                    Loading subtitle content...
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6" id="target-column">
                        <div class="subtitle-panel">
                            <h5 class="panel-title" id="target-lang-title">Target Language</h5>
                            <div class="subtitle-content" id="target-content">
                                <div class="subtitle-line-placeholder">
                                    Loading subtitle content...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Display -->
    <div class="row mt-3" id="error-container" style="display: none;">
        <div class="col-12">
            <div class="alert alert-danger" role="alert" id="error-message">
                An error occurred while loading subtitle data.
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div class="row mt-3" id="loading-container">
        <div class="col-12 text-center">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading subtitle data...</p>
        </div>
    </div>
</div>

<!-- Hidden data for JavaScript -->
<script type="application/json" id="learning-data">
{
    "subLinkId": {{ sub_link_id }},
    "fromLang": {{ sub_link.fromlang }},
    "toLang": {{ sub_link.tolang }}
}
</script>
{% endblock %}

{% block scripts %}
<link href="{{ url_for('static', filename='css/learning.css') }}" rel="stylesheet">
<script src="{{ url_for('static', filename='js/components/dual-subtitle-display.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/subtitle-player.js') }}"></script>
<script>
    // Initialize learning interface when page loads
    document.addEventListener('DOMContentLoaded', function() {
        const learningData = JSON.parse(document.getElementById('learning-data').textContent);
        
        // Initialize subtitle player
        const subtitlePlayer = new SubtitlePlayer(learningData.subLinkId, 0);
        
        // Set up keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            switch(event.key) {
                case 'ArrowLeft':
                    event.preventDefault();
                    subtitlePlayer.previousAlignment();
                    break;
                case 'ArrowRight':
                    event.preventDefault();
                    subtitlePlayer.nextAlignment();
                    break;
            }
        });
    });
</script>
{% endblock %}