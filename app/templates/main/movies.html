{% extends "base.html" %}

{% block title %}Movie Catalog - Subtitle Learning{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <!-- Alphabetical Navigation Sidebar -->
        <div class="col-lg-2 col-md-3 d-none d-md-block">
            <div class="sticky-top" style="top: 20px;">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-sort-alpha-down me-2"></i>
                            Browse by Letter
                        </h6>
                    </div>
                    <div class="card-body p-2">
                        <!-- All option -->
                        <button type="button" 
                                class="btn btn-outline-primary btn-sm w-100 mb-2 letter-btn" 
                                data-letter="all">
                            All Movies
                        </button>
                        
                        <!-- Letter navigation grid -->
                        <div class="row g-1" id="letter-navigation">
                            <!-- A-Z letters will be populated here by JavaScript -->
                        </div>
                        
                        <!-- Number option -->
                        <button type="button" 
                                class="btn btn-outline-secondary btn-sm w-100 mt-2 letter-btn" 
                                data-letter="#"
                                title="Movies starting with numbers">
                            # (0-9)
                        </button>
                    </div>
                </div>
                
                <!-- Letter counts info -->
                <div id="letter-counts-info" class="mt-3 d-none">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        <span id="letters-with-movies-count">0</span> letters have movies
                    </small>
                </div>
            </div>
        </div>
        
        <!-- Mobile letter navigation (collapsible) -->
        <div class="col-12 d-md-none mb-3">
            <div class="card">
                <div class="card-header">
                    <button class="btn btn-link text-decoration-none p-0 w-100 text-start" 
                            type="button" 
                            data-bs-toggle="collapse" 
                            data-bs-target="#mobile-letter-nav" 
                            aria-expanded="false">
                        <i class="fas fa-sort-alpha-down me-2"></i>
                        Browse by Letter
                        <i class="fas fa-chevron-down float-end"></i>
                    </button>
                </div>
                <div class="collapse" id="mobile-letter-nav">
                    <div class="card-body p-2">
                        <!-- All option -->
                        <button type="button" 
                                class="btn btn-outline-primary btn-sm w-100 mb-2 letter-btn" 
                                data-letter="all">
                            All Movies
                        </button>
                        
                        <!-- Letter navigation grid for mobile -->
                        <div class="row g-1" id="mobile-letter-navigation">
                            <!-- A-Z letters will be populated here by JavaScript -->
                        </div>
                        
                        <!-- Number option -->
                        <button type="button" 
                                class="btn btn-outline-secondary btn-sm w-100 mt-2 letter-btn" 
                                data-letter="#"
                                title="Movies starting with numbers">
                            # (0-9)
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main content area -->
        <div class="col-lg-10 col-md-9 col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h2">Movie Catalog</h1>
                <a href="{{ url_for('auth.dashboard') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>

            <!-- Loading indicator -->
            <div id="loading-indicator" class="text-center py-4">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading movies...</span>
                </div>
                <p class="mt-2 text-muted">Loading available movies...</p>
            </div>

            <!-- Error message -->
            <div id="error-message" class="alert alert-danger d-none" role="alert">
                <h5 class="alert-heading">Error Loading Movies</h5>
                <p id="error-text"></p>
                <button type="button" class="btn btn-outline-danger btn-sm" onclick="movieDiscovery.loadMovies()">
                    Try Again
                </button>
            </div>

            <!-- Search bar -->
            <div id="search-container" class="mb-4 d-none">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" 
                                   id="movie-search" 
                                   class="form-control" 
                                   placeholder="Search movies by title..."
                                   autocomplete="off">
                            <button class="btn btn-outline-secondary" 
                                    type="button" 
                                    id="clear-search"
                                    title="Clear search">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div id="search-results-info" class="mt-2 text-muted small d-none">
                            <span id="search-result-count"></span>
                        </div>
                        <div id="letter-filter-info" class="mt-1 d-none">
                            <span class="badge bg-secondary">
                                <i class="fas fa-filter me-1"></i>
                                Letter: <span id="active-letter-display"></span>
                                <button type="button" class="btn-close btn-close-white btn-sm ms-1" 
                                        id="clear-letter-filter" 
                                        title="Clear letter filter"></button>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Movie list container -->
            <div id="movie-list-container" class="d-none">
                <div class="row mb-3">
                    <div class="col">
                        <p class="text-muted mb-0">
                            Showing movies with subtitles available for your language pair: 
                            <span id="language-pair" class="badge bg-primary"></span>
                        </p>
                    </div>
                </div>

                <!-- Movie list -->
                <div id="movie-list" class="list-group">
                    <!-- Movies will be populated here by JavaScript -->
                </div>

                <!-- Empty state -->
                <div id="empty-state" class="text-center py-5 d-none">
                    <div class="mb-3">
                        <i class="fas fa-film fa-3x text-muted"></i>
                    </div>
                    <h4>No Movies Available</h4>
                    <p class="text-muted">
                        No movies found with subtitles for your selected language pair.<br>
                        Try updating your language preferences in your profile.
                    </p>
                    <a href="{{ url_for('auth.profile') }}" class="btn btn-primary">
                        Update Language Preferences
                    </a>
                </div>

                <!-- No search results state -->
                <div id="no-search-results" class="text-center py-5 d-none">
                    <div class="mb-3">
                        <i class="fas fa-search fa-3x text-muted"></i>
                    </div>
                    <h4>No Search Results</h4>
                    <p class="text-muted">
                        No movies found matching "<span id="search-query-display"></span>".<br>
                        Try searching with different keywords or clear the search to see all movies.
                    </p>
                    <button type="button" class="btn btn-outline-primary" id="clear-search-from-no-results">
                        Clear Search
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Movie selection confirmation modal -->
<div class="modal fade" id="movieSelectionModal" tabindex="-1" aria-labelledby="movieSelectionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="movieSelectionModalLabel">Start Learning Session</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>You've selected: <strong id="selected-movie-title"></strong></p>
                <p class="text-muted">Ready to start your subtitle learning session?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirm-movie-selection">
                    Start Learning Session
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/modules/movie-discovery.js') }}"></script>
<script>
    // Initialize movie discovery component when page loads
    document.addEventListener('DOMContentLoaded', function() {
        window.movieDiscovery = new MovieDiscovery();
        movieDiscovery.init();
    });
</script>
{% endblock %}